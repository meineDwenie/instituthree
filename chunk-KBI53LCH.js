import{b as re}from"./chunk-5V5OQLIX.js";import{a as b,b as L,c as ae,d as v,e as R,f as D,g as _}from"./chunk-YEFIVP7E.js";import{e as de,f as me,g as ce,h as F}from"./chunk-HNDYEKJP.js";import{a as se,b as le,c as A,d as U}from"./chunk-MXKXLBHX.js";import{a as te}from"./chunk-YNFTKU7D.js";import{b as ie}from"./chunk-UYOCD7B4.js";import"./chunk-FXHPCVZO.js";import"./chunk-LCBHQNYP.js";import"./chunk-DI2GF6D7.js";import{a as ne,b as T}from"./chunk-BOFTZJPA.js";import{M as h,N as C,b as ee,g as oe,h as w}from"./chunk-Z7IPVWHD.js";import{b as Y,f as E,i as O,m as Z,o as I}from"./chunk-3NOR6IXB.js";import"./chunk-AZTHPTC5.js";import{Fb as t,Gb as r,Hb as f,Hc as X,Ic as S,Kc as u,Lb as K,Nb as p,Ob as Q,Ya as J,Yb as s,Zb as k,_a as l,_b as V,ac as P,bc as y,cc as x,db as m,ka as z,kb as g,la as H,pb as M,wb as c}from"./chunk-RHI7NKML.js";var N=class a{constructor(o){this.dialogRef=o}roleName="";onCancel(){this.dialogRef.close()}onSave(){this.roleName.trim()?this.dialogRef.close(this.roleName):alert("Role name cannot be empty")}static \u0275fac=function(e){return new(e||a)(m(b))};static \u0275cmp=g({type:a,selectors:[["app-add-role-dialog"]],decls:12,vars:2,consts:[["mat-dialog-title",""],["appearance","outline",2,"width","100%"],["matInput","","placeholder","Enter role name","required","",3,"ngModelChange","ngModel"],["align","end"],["mat-button","",3,"click"],["mat-raised-button","","color","primary",3,"click","disabled"]],template:function(e,i){e&1&&(t(0,"h2",0),s(1,"New Role Addition"),r(),t(2,"mat-dialog-content")(3,"mat-form-field",1)(4,"mat-label"),s(5,"Role"),r(),t(6,"input",2),x("ngModelChange",function(d){return y(i.roleName,d)||(i.roleName=d),d}),r()()(),t(7,"mat-dialog-actions",3)(8,"button",4),p("click",function(){return i.onCancel()}),s(9,"Cancel"),r(),t(10,"button",5),p("click",function(){return i.onSave()}),s(11," Save Role "),r()()),e&2&&(l(6),P("ngModel",i.roleName),l(4),c("disabled",!i.roleName.trim()))},dependencies:[u,_,v,D,R,C,h,w,oe,ee,T,ne,I,Y,E,Z,O],encapsulation:2})};var B=class a{constructor(o,e){this.dialogRef=o;this.role=e}onCancel(){this.dialogRef.close(!1)}onDelete(){this.dialogRef.close(!0)}static \u0275fac=function(e){return new(e||a)(m(b),m(L))};static \u0275cmp=g({type:a,selectors:[["app-delete-confirmation-dialog"]],decls:14,vars:2,consts:[["mat-dialog-title",""],[1,"role-info"],["alt","Role","width","40","height","40",2,"border-radius","50%",3,"src"],["align","end"],["mat-button","",3,"click"],["mat-raised-button","","color","warn",3,"click"]],template:function(e,i){e&1&&(t(0,"h2",0),s(1,"Confirm role deletion"),r(),t(2,"mat-dialog-content")(3,"p"),s(4,"Are you sure you want to delete this role?"),r(),t(5,"div",1),f(6,"img",2),t(7,"span"),s(8),r()()(),t(9,"mat-dialog-actions",3)(10,"button",4),p("click",function(){return i.onCancel()}),s(11,"Cancel"),r(),t(12,"button",5),p("click",function(){return i.onDelete()}),s(13,"Delete"),r()()),e&2&&(l(6),c("src",i.role.photoUrl,J),l(2),k(i.role.name))},dependencies:[u,_,v,D,R,C,h],styles:[".role-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;margin-top:16px;padding:12px;border:1px solid #e0e0e0;border-radius:8px;background-color:#f9f9f9}.role-info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:500}"]})};function _e(a,o){a&1&&(t(0,"div",7),f(1,"mat-spinner",8),t(2,"p"),s(3,"Loading permissions..."),r()())}function Me(a,o){if(a&1){let e=K();t(0,"mat-checkbox",15),x("ngModelChange",function(n){let d=z(e).$implicit;return y(d.checked,n)||(d.checked=n),H(n)}),s(1),r()}if(a&2){let e=o.$implicit;P("ngModel",e.checked),l(),V(" ",e.name," ")}}function be(a,o){if(a&1&&(t(0,"div",12)(1,"h3"),s(2),r(),t(3,"div",13),M(4,Me,2,2,"mat-checkbox",14),r()()),a&2){let e=o.$implicit;l(2),k(e.name),l(2),c("ngForOf",e.permissions)}}function ve(a,o){if(a&1&&(t(0,"div",9)(1,"div",10),M(2,be,5,2,"div",11),r()()),a&2){let e=Q();l(2),c("ngForOf",e.permissionGroups)}}var j=class a{constructor(o,e,i){this.dialogRef=o;this.data=e;this.rolesService=i}roleId;role;isLoading=!0;permissionGroups=[{name:"User Management",permissions:[{id:"view_users",name:"View Users",checked:!1},{id:"create_users",name:"Create Users",checked:!1},{id:"edit_users",name:"Edit Users",checked:!1},{id:"delete_users",name:"Delete Users",checked:!1}]},{name:"Course Management",permissions:[{id:"view_courses",name:"View Courses",checked:!1},{id:"create_courses",name:"Create Courses",checked:!1},{id:"edit_courses",name:"Edit Courses",checked:!1},{id:"delete_courses",name:"Delete Courses",checked:!1}]},{name:"Report Management",permissions:[{id:"view_reports",name:"View Reports",checked:!1},{id:"create_reports",name:"Create Reports",checked:!1},{id:"export_reports",name:"Export Reports",checked:!1}]}];ngOnInit(){this.roleId=this.data.roleId,this.loadRoleData()}loadRoleData(){this.isLoading=!0,this.rolesService.getRoleById(this.roleId).subscribe({next:o=>{if(this.role=o,!this.role||!this.role.id){this.dialogRef.close();return}this.rolesService.getRolePermissions(this.roleId).subscribe({next:e=>{this.resetPermissions(),this.setPermissionsFromArray(e),this.isLoading=!1},error:e=>{console.error("Error loading permissions:",e),this.isLoading=!1,this.dialogRef.close()}})},error:o=>{console.error("Error loading role:",o),this.isLoading=!1,this.dialogRef.close()}})}resetPermissions(){this.permissionGroups.forEach(o=>{o.permissions.forEach(e=>{e.checked=!1})})}setPermissionsFromArray(o){!o||!Array.isArray(o)||o.forEach(e=>{this.setPermission(e,!0)})}setPermission(o,e){for(let i of this.permissionGroups){let n=i.permissions.find(d=>d.id===o);if(n){n.checked=e;break}}}savePermissions(){if(!this.role)return;this.isLoading=!0;let o=[];this.permissionGroups.forEach(e=>{e.permissions.forEach(i=>{i.checked&&o.push(i.id)})}),this.rolesService.updateRolePermissions(this.roleId,o).subscribe({next:()=>{this.isLoading=!1,this.dialogRef.close(!0)},error:e=>{console.error("Error saving permissions:",e),this.isLoading=!1,this.dialogRef.close(!1)}})}cancel(){this.dialogRef.close(!1)}static \u0275fac=function(e){return new(e||a)(m(b),m(L),m(F))};static \u0275cmp=g({type:a,selectors:[["app-edit-roles-permission-dialog"]],decls:10,vars:4,consts:[[1,"dialog-container"],["mat-dialog-title",""],["class","loading-container",4,"ngIf"],["mat-dialog-content","",4,"ngIf"],["mat-dialog-actions","","align","end"],["mat-button","",3,"click"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"loading-container"],["diameter","40"],["mat-dialog-content",""],[1,"permissions-container"],["class","permission-group",4,"ngFor","ngForOf"],[1,"permission-group"],[1,"permission-list"],["color","primary","class","permission-checkbox",3,"ngModel","ngModelChange",4,"ngFor","ngForOf"],["color","primary",1,"permission-checkbox",3,"ngModelChange","ngModel"]],template:function(e,i){e&1&&(t(0,"div",0)(1,"h2",1),s(2),r(),M(3,_e,4,0,"div",2)(4,ve,3,1,"div",3),t(5,"div",4)(6,"button",5),p("click",function(){return i.cancel()}),s(7,"Cancel"),r(),t(8,"button",6),p("click",function(){return i.savePermissions()}),s(9," Save Permissions "),r()()()),e&2&&(l(2),V("Edit Permissions for ",i.role==null?null:i.role.name,""),l(),c("ngIf",i.isLoading),l(),c("ngIf",!i.isLoading),l(4),c("disabled",i.isLoading))},dependencies:[u,X,S,de,C,h,ce,me,w,T,I,E,O,_,v,D,R,U,A],styles:[".edit-role-container[_ngcontent-%COMP%]{padding:20px;max-width:800px}.edit-role-container[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin-bottom:20px;color:#333}.edit-role-container[_ngcontent-%COMP%]   .role-header[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:20px}.edit-role-container[_ngcontent-%COMP%]   .role-header[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:50%;margin-right:15px;object-fit:cover}.edit-role-container[_ngcontent-%COMP%]   .role-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.5rem;font-weight:500}.edit-role-container[_ngcontent-%COMP%]   .permissions-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px;margin-bottom:24px}.edit-role-container[_ngcontent-%COMP%]   .permissions-container[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]{margin-bottom:0}.edit-role-container[_ngcontent-%COMP%]   .permissions-container[_ngcontent-%COMP%]   .permissions-list[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:10px;padding:10px 0}.edit-role-container[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:10px;margin-top:20px}p[_ngcontent-%COMP%]{font-family:Murecho,sans-serif}.loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:100%}"]})};function Re(a,o){a&1&&(t(0,"div",6),f(1,"mat-spinner",7),r())}var pe=class a{constructor(o,e,i){this.dialog=o;this.snackBar=e;this.rolesService=i}roles=[];displayedColumns=["nameId","actions"];adaptedRolesData=[];isLoading=!0;ngOnInit(){this.loadRoles()}loadRoles(){this.isLoading=!0,this.rolesService.getRoles().subscribe({next:o=>{this.roles=o,this.adaptRolesToUserData(),this.isLoading=!1},error:o=>{console.error("Error loading roles:",o),this.isLoading=!1,this.snackBar.open("Failed to load roles. Please try again later.","Close",{duration:5e3,panelClass:["error-snackbar"]})}})}adaptRolesToUserData(){this.adaptedRolesData=this.roles.map(o=>{let e="User",i=`${o.name.toLowerCase()}@example.com`,n=`${o.name.toLowerCase()}.${e.toLowerCase()}`;return{id:o.id.toString(),name:o.name,lastName:e,username:n,email:i,password:"",role:"Usuario",status:"Active",photoUrl:o.photoUrl}})}openAddRoleDialog(){this.dialog.open(N,{width:"400px"}).afterClosed().subscribe(e=>{if(e){this.isLoading=!0;let i={id:0,name:e,photoUrl:"assets/images/default-role-icon.svg"};this.rolesService.createRole(i).subscribe({next:n=>{this.loadRoles(),this.snackBar.open(`Role '${n.name}' created successfully`,"Close",{duration:3e3,panelClass:["success-snackbar"]})},error:n=>{console.error("Error creating role:",n),this.isLoading=!1,this.snackBar.open("Failed to create role. Please try again later.","Close",{duration:5e3,panelClass:["error-snackbar"]})}})}})}findOriginalRole(o){return this.roles.find(e=>e.id.toString()===o.id)}editPermissions(o){let e=this.findOriginalRole(o);e&&this.dialog.open(j,{width:"800px",data:{roleId:e.id}}).afterClosed().subscribe(n=>{n&&(this.isLoading=!0,setTimeout(()=>{this.loadRoles(),this.snackBar.open(`Permissions for '${e.name}' updated successfully`,"Close",{duration:3e3,panelClass:["success-snackbar"]})},500))})}deleteRole(o){let e=this.findOriginalRole(o);e&&this.dialog.open(B,{width:"400px",data:e}).afterClosed().subscribe(n=>{if(n){this.isLoading=!0;let d=e.name;this.rolesService.deleteRole(e.id).subscribe({next:()=>{this.loadRoles(),this.snackBar.open(`Role '${d}' deleted successfully`,"Close",{duration:3e3,panelClass:["warning-snackbar"]})},error:ge=>{console.error("Error deleting role:",ge),this.isLoading=!1,this.snackBar.open("Failed to delete role. Please try again later.","Close",{duration:5e3,panelClass:["error-snackbar"]})}})}})}applyFilter(o){console.log("Filter applied:",o)}static \u0275fac=function(e){return new(e||a)(m(ae),m(se),m(F))};static \u0275cmp=g({type:a,selectors:[["app-roles-management"]],decls:11,vars:3,consts:[[1,"roles-management-container"],[1,"header"],["mat-raised-button","","color","primary",1,"btn-addrole",3,"click"],[1,"bi","bi-plus",2,"margin-right","8px"],["class","loading-spinner",4,"ngIf"],[3,"editUser","deleteUser","filterChange","displayedColumns","userData"],[1,"loading-spinner"],["diameter","40"]],template:function(e,i){e&1&&(f(0,"app-header-nav")(1,"app-sidebar"),t(2,"div",0)(3,"div",1)(4,"h1"),s(5,"User Roles"),r(),t(6,"button",2),p("click",function(){return i.openAddRoleDialog()}),f(7,"i",3),s(8," Add new role "),r()(),M(9,Re,2,0,"div",4),t(10,"app-users-table",5),p("editUser",function(d){return i.editPermissions(d)})("deleteUser",function(d){return i.deleteRole(d)})("filterChange",function(d){return i.applyFilter(d)}),r()()),e&2&&(l(9),c("ngIf",i.isLoading),l(),c("displayedColumns",i.displayedColumns)("userData",i.adaptedRolesData))},dependencies:[u,S,ie,te,re,C,h,_,U,A,le],styles:["html[_ngcontent-%COMP%], body[_ngcontent-%COMP%]{font-family:Murecho,sans-serif;height:100vh;margin:0;padding:0;overflow:hidden}.roles-management-container[_ngcontent-%COMP%]{height:calc(100vh - 100px);padding:20px 50px;margin-left:320px;background-color:#f6f6f6}.roles-management-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}h1[_ngcontent-%COMP%]{margin:0;font-family:Murecho,sans-serif!important}.btn-addrole[_ngcontent-%COMP%]{color:#000!important;background-color:#70d3c3!important;border-radius:10px;border:black 1px solid;display:flex;align-items:center;padding:0 14px;line-height:1}.loading-spinner[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:100vh}  .success-snackbar{background-color:#4caf50!important;color:#fff}  .warning-snackbar{background-color:#ff9800!important;color:#fff}  .error-snackbar{background-color:#f44336!important;color:#fff}  .mat-mdc-snack-bar-action{color:#fff!important}"]})};export{pe as RolesComponent};
