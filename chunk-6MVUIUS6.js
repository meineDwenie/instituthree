import{a as De}from"./chunk-T7SENGVI.js";import{a as fe,b as be,c as we,d as Ce,e as Me,f as xe}from"./chunk-HUSZGOD4.js";import{a as Ue,b as ve,c as P,d as I,e as _e,f as O,g as F,h as R,i as k}from"./chunk-NAX2RAWJ.js";import{a as he}from"./chunk-F2KXFFDS.js";import{b as ge}from"./chunk-NWUC4BUM.js";import{b as x,c as Z,q as G}from"./chunk-LIPYNN36.js";import{O as se,P as le,T as me,U as de,X as pe,b as Q,d as h,f as X,g as Y,j as ee,k as te,l as ae,m as re,n as oe,o as ie,p as ne,ta as ce,va as ue,xa as D,ya as y}from"./chunk-6YGK5VPP.js";import{$b as W,B as b,Fb as i,G as f,Gb as o,Hb as d,Hc as K,Ic as E,Kc as M,Nb as v,Ob as L,V as U,Y as A,Ya as N,Yb as s,_a as l,_b as S,a as w,b as J,ba as $,db as g,kb as C,n as u,o as _,pb as p,r as V,wb as m}from"./chunk-ZJGJM7HA.js";var T=class r{constructor(e,a){this.dialogRef=e;this.data=a}onCancel(){this.dialogRef.close(!1)}onConfirmDelete(){this.dialogRef.close(!0)}static \u0275fac=function(a){return new(a||r)(g(P),g(I))};static \u0275cmp=C({type:r,selectors:[["app-delete-user-dialog"]],decls:19,vars:4,consts:[[1,"delete-dialog-container"],["mat-dialog-title",""],["mat-dialog-content",""],[1,"confirmation-message"],[1,"user-info-box"],[1,"user-details"],["alt","User photo",1,"user-avatar",3,"src"],[1,"user-text"],[1,"user-name"],[1,"user-id"],["mat-dialog-actions","","align","end"],["mat-button","",1,"cancel-button",3,"click"],["mat-raised-button","","color","warn",3,"click"]],template:function(a,t){a&1&&(i(0,"div",0)(1,"h2",1),s(2,"Confirm User Deletion"),o(),i(3,"div",2)(4,"p",3),s(5," Are you sure you want to delete this user? "),o(),i(6,"div",4)(7,"div",5),d(8,"img",6),i(9,"div",7)(10,"p",8),s(11),o(),i(12,"p",9),s(13),o()()()()(),i(14,"div",10)(15,"button",11),v("click",function(){return t.onCancel()}),s(16," Cancel "),o(),i(17,"button",12),v("click",function(){return t.onConfirmDelete()}),s(18," Delete "),o()()()),a&2&&(l(8),m("src",t.data.user.photoUrl,N),l(3),W("",t.data.user.name," ",t.data.user.lastName,""),l(2),S("ID: ",t.data.user.id,""))},dependencies:[M,k,O,R,F,y,D],styles:[".delete-dialog-container[_ngcontent-%COMP%]{padding:6px 24px}h2[_ngcontent-%COMP%]{margin-bottom:16px;color:#333}.confirmation-message[_ngcontent-%COMP%]{font-size:16px;margin-bottom:20px;color:#555}.user-info-box[_ngcontent-%COMP%]{border:1px solid #e0e0e0;border-radius:8px;padding:16px;background-color:#f0eeee;margin-bottom:16px;border:1px solid #000000}.user-details[_ngcontent-%COMP%]{display:flex;align-items:center}.user-avatar[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:50%;object-fit:cover;margin-right:16px;border:1px solid #000000}.user-text[_ngcontent-%COMP%]{display:flex;flex-direction:column}.user-name[_ngcontent-%COMP%]{font-size:16px;font-weight:500;margin:0 0 4px}.user-id[_ngcontent-%COMP%]{font-size:14px;color:#666;margin:0}mat-dialog-actions[_ngcontent-%COMP%]{padding:16px 0 0;margin-bottom:0}.mat-mdc-raised-button[_ngcontent-%COMP%]:not(:disabled){color:#fff;background-color:#ec6666;border-radius:10px;padding:0 40px}.mat-mdc-raised-button[_ngcontent-%COMP%]:not(:disabled):hover{background-color:#ec4e4e}.cancel-button[_ngcontent-%COMP%]{background-color:transparent;color:#f99191!important;padding:0 30px;border-radius:10px}.cancel-button[_ngcontent-%COMP%]:hover{color:#db6b6b!important;background-color:#fee!important}"]})};function Ee(r,e){r&1&&(i(0,"mat-error"),s(1," First name is required "),o())}function Pe(r,e){r&1&&(i(0,"mat-error"),s(1,"Name must be at least 3 characters"),o())}function Ie(r,e){r&1&&(i(0,"mat-error"),s(1," Last name is required "),o())}function Oe(r,e){r&1&&(i(0,"mat-error"),s(1,"Name must be at least 3 characters"),o())}function Fe(r,e){r&1&&(i(0,"mat-error"),s(1,"Email is required"),o())}function Re(r,e){r&1&&(i(0,"mat-error"),s(1,"Please enter a valid email"),o())}function Te(r,e){r&1&&(i(0,"span"),s(1,"Password is required"),o())}function je(r,e){r&1&&(i(0,"span"),s(1,"Minimum 6 characters"),o())}function qe(r,e){if(r&1&&(i(0,"mat-error"),p(1,Te,2,0,"span",8)(2,je,2,0,"span",8),o()),r&2){let a=L();l(),m("ngIf",a.password==null||a.password.errors==null?null:a.password.errors.required),l(),m("ngIf",a.password==null||a.password.errors==null?null:a.password.errors.minlength)}}function ze(r,e){if(r&1&&(i(0,"mat-option",22),s(1),o()),r&2){let a=e.$implicit;m("value",a),l(),S(" ",a," ")}}function Be(r,e){r&1&&(i(0,"mat-error"),s(1,"Role is required"),o())}function $e(r,e){if(r&1&&(i(0,"mat-option",22),s(1),o()),r&2){let a=e.$implicit;m("value",a),l(),S(" ",a," ")}}function Le(r,e){r&1&&(i(0,"mat-error"),s(1,"Status is required"),o())}function Ge(r,e){if(r&1&&(i(0,"div",23),d(1,"img",24),o()),r&2){let a,t=L();l(),m("src",(a=t.userForm.get("photoUrl"))==null?null:a.value,N)}}var q=class r{constructor(e,a,t){this.fb=e;this.dialogRef=a;this.data=t;this.userForm=this.fb.group({id:[{value:"",disabled:!0}],name:["",[h.required,h.minLength(2)]],lastName:["",[h.required,h.minLength(2)]],email:["",[h.required,h.email]],password:["",[h.required,h.minLength(6)]],role:["",h.required],status:["",h.required],photoUrl:[""]})}userForm;roles=["Usuario","Admin"];statuses=["Active","Pending"];ngOnInit(){this.data.user&&this.userForm.patchValue({id:this.data.user.id,name:this.data.user.name,lastName:this.data.user.lastName,email:this.data.user.email,role:this.data.user.role,status:this.data.user.status,photoUrl:this.data.user.photoUrl})}onCancel(){this.dialogRef.close(!1)}onSave(){if(this.userForm.valid){let e=this.userForm.value;this.dialogRef.close(e)}else console.log("Form is invalid")}get name(){return this.userForm.get("name")}get lastName(){return this.userForm.get("lastName")}get email(){return this.userForm.get("email")}get role(){return this.userForm.get("role")}get status(){return this.userForm.get("status")}get password(){return this.userForm.get("password")}static \u0275fac=function(a){return new(a||r)(g(oe),g(P),g(I))};static \u0275cmp=C({type:r,selectors:[["app-add-user-dialog"]],decls:61,vars:15,consts:[[1,"dialog-container"],["mat-dialog-title",""],[3,"ngSubmit","formGroup"],["mat-dialog-content",""],[1,"form-row"],["appearance","outline",1,"full-width"],["matInput","","formControlName","id","readonly",""],["matInput","","formControlName","name","placeholder","Enter first name"],[4,"ngIf"],["matInput","","formControlName","lastName","placeholder","Enter last name"],["matInput","","formControlName","email","placeholder","Enter email","type","email"],["matInput","","formControlName","password","required","",3,"type"],[1,"form-row","two-columns"],["appearance","outline"],["formControlName","role"],[3,"value",4,"ngFor","ngForOf"],["formControlName","status"],["matInput","","formControlName","photoUrl","placeholder","Enter photo URL"],["class","avatar-preview",4,"ngIf"],["mat-dialog-actions","","align","end"],["mat-button","","type","button",1,"cancel-button",3,"click"],["mat-raised-button","","type","submit",1,"save-button",3,"disabled"],[3,"value"],[1,"avatar-preview"],["alt","User avatar",3,"src"]],template:function(a,t){if(a&1&&(i(0,"div",0)(1,"h2",1),s(2,"Add New User"),o(),i(3,"form",2),v("ngSubmit",function(){return t.onSave()}),i(4,"div",3)(5,"div",4)(6,"mat-form-field",5)(7,"mat-label"),s(8,"ID"),o(),d(9,"input",6),o()(),i(10,"div",4)(11,"mat-form-field",5)(12,"mat-label"),s(13,"First Name"),o(),d(14,"input",7),p(15,Ee,2,0,"mat-error",8)(16,Pe,2,0,"mat-error",8),o()(),i(17,"div",4)(18,"mat-form-field",5)(19,"mat-label"),s(20,"Last Name"),o(),d(21,"input",9),p(22,Ie,2,0,"mat-error",8)(23,Oe,2,0,"mat-error",8),o()(),i(24,"div",4)(25,"mat-form-field",5)(26,"mat-label"),s(27,"Email"),o(),d(28,"input",10),p(29,Fe,2,0,"mat-error",8)(30,Re,2,0,"mat-error",8),o()(),i(31,"div",4)(32,"mat-form-field",5)(33,"mat-label"),s(34,"Password"),o(),d(35,"input",11),p(36,qe,3,2,"mat-error",8),o()(),i(37,"div",12)(38,"mat-form-field",13)(39,"mat-label"),s(40,"Role"),o(),i(41,"mat-select",14),p(42,ze,2,2,"mat-option",15),o(),p(43,Be,2,0,"mat-error",8),o(),i(44,"mat-form-field",13)(45,"mat-label"),s(46,"Status"),o(),i(47,"mat-select",16),p(48,$e,2,2,"mat-option",15),o(),p(49,Le,2,0,"mat-error",8),o()(),i(50,"div",4)(51,"mat-form-field",5)(52,"mat-label"),s(53,"Photo URL"),o(),d(54,"input",17),o()(),p(55,Ge,2,1,"div",18),o(),i(56,"div",19)(57,"button",20),v("click",function(){return t.onCancel()}),s(58," Cancel "),o(),i(59,"button",21),s(60," Save "),o()()()()),a&2){let n,c,H;l(3),m("formGroup",t.userForm),l(12),m("ngIf",(n=t.userForm.get("name"))==null||n.errors==null?null:n.errors.required),l(),m("ngIf",t.name==null||t.name.errors==null?null:t.name.errors.minlength),l(6),m("ngIf",(c=t.userForm.get("lastName"))==null||c.errors==null?null:c.errors.required),l(),m("ngIf",t.lastName==null||t.lastName.errors==null?null:t.lastName.errors.minlength),l(6),m("ngIf",t.email==null||t.email.errors==null?null:t.email.errors.required),l(),m("ngIf",t.email==null||t.email.errors==null?null:t.email.errors.email),l(5),m("type","password"),l(),m("ngIf",(t.password==null?null:t.password.invalid)&&((t.password==null?null:t.password.dirty)||(t.password==null?null:t.password.touched))),l(6),m("ngForOf",t.roles),l(),m("ngIf",t.role==null||t.role.errors==null?null:t.role.errors.required),l(5),m("ngForOf",t.statuses),l(),m("ngIf",t.status==null||t.status.errors==null?null:t.status.errors.required),l(6),m("ngIf",(H=t.userForm.get("photoUrl"))==null?null:H.value),l(4),m("disabled",!t.userForm.valid)}},dependencies:[M,K,E,k,O,R,F,de,me,se,le,ve,Ue,ue,ce,pe,y,D,ie,ee,Q,X,Y,re,ne,te,ae],styles:[".dialog-container[_ngcontent-%COMP%]{padding:0;max-width:500px}.form-row[_ngcontent-%COMP%]{margin-bottom:16px}.full-width[_ngcontent-%COMP%]{width:100%}.two-columns[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:16px}.avatar-preview[_ngcontent-%COMP%]{display:flex;justify-content:center;margin:16px 0}.avatar-preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100px;height:100px;border-radius:50%;object-fit:cover;border:1px solid #ddd}h2[_ngcontent-%COMP%]{margin-bottom:0;color:#333}mat-dialog-content[_ngcontent-%COMP%]{margin-bottom:24px}mat-dialog-actions[_ngcontent-%COMP%]{padding:16px 0;margin-bottom:0}.mat-mdc-raised-button[_ngcontent-%COMP%]:disabled{border-radius:10px;padding:0 40px}.mat-mdc-raised-button[_ngcontent-%COMP%]:not(:disabled){color:#fff;background-color:#577839;border-radius:10px;padding:0 40px}.mat-mdc-raised-button[_ngcontent-%COMP%]:not(:disabled):hover{background-color:#50722f}.cancel-button[_ngcontent-%COMP%]{color:#577839!important;padding:0 30px;border-radius:10px}.cancel-button[_ngcontent-%COMP%]:hover{background-color:#fafff5!important}"]})};var z=class r{mockUsers=[{id:"1001",name:"John",lastName:"Doe",username:"john.doe",email:"john.doe@example.com",password:"password123",role:"Usuario",status:"Active",photoUrl:"https://i.pravatar.cc/150?img=1"},{id:"1002",name:"Jane",lastName:"Smith",username:"jane.smith",email:"jane.smith@example.com",password:"password123",role:"Usuario",status:"Active",photoUrl:"https://i.pravatar.cc/150?img=5"},{id:"1003",name:"Robert",lastName:"Johnson",username:"robert.johnson",email:"robert.johnson@example.com",password:"password123",role:"Admin",status:"Active",photoUrl:"https://i.pravatar.cc/150?img=8"},{id:"1004",name:"Emily",lastName:"Davis",username:"emily.davis",email:"emily.davis@example.com",password:"password123",role:"Usuario",status:"Pending",photoUrl:"https://i.pravatar.cc/150?img=9"},{id:"1005",name:"Michael",lastName:"Wilson",username:"michael.wilson",email:"michael.wilson@example.com",password:"password123",role:"Usuario",status:"Active",photoUrl:"https://i.pravatar.cc/150?img=11"},{id:"1006",name:"Sarah",lastName:"Taylor",username:"sarah.taylor",email:"sarah.taylor@example.com",password:"password123",role:"Usuario",status:"Pending",photoUrl:"https://i.pravatar.cc/150?img=10"},{id:"1007",name:"David",lastName:"Brown",username:"david.brown",email:"david.brown@example.com",password:"password123",role:"Usuario",status:"Active",photoUrl:"https://i.pravatar.cc/150?img=12"},{id:"1008",name:"Jennifer",lastName:"Garcia",username:"jennifer.garcia",email:"jennifer.garcia@example.com",password:"password123",role:"Usuario",status:"Active",photoUrl:"https://i.pravatar.cc/150?img=25"},{id:"1009",name:"Thomas",lastName:"Martinez",username:"thomas.martinez",email:"thomas.martinez@example.com",password:"password123",role:"Usuario",status:"Active",photoUrl:"https://i.pravatar.cc/150?img=15"},{id:"1010",name:"Lisa",lastName:"Robinson",username:"lisa.robinson",email:"lisa.robinson@example.com",password:"password123",role:"Usuario",status:"Pending",photoUrl:"https://i.pravatar.cc/150?img=23"},{id:"1011",name:"Carlos",lastName:"Mendoza",username:"carlos.mendoza",email:"carlos.mendoza@example.com",password:"password123",role:"Usuario",status:"Active",photoUrl:"https://i.pravatar.cc/150?img=30"},{id:"1012",name:"Elena",lastName:"Rodriguez",username:"elena.rodriguez",email:"elena.rodriguez@example.com",password:"password123",role:"Usuario",status:"Active",photoUrl:"https://i.pravatar.cc/150?img=31"},{id:"1013",name:"Nathan",lastName:"Black",username:"nathan.black",email:"nathan.black@example.com",password:"password123",role:"Usuario",status:"Pending",photoUrl:"https://i.pravatar.cc/150?img=32"},{id:"1014",name:"Olivia",lastName:"White",username:"olivia.white",email:"olivia.white@example.com",password:"password123",role:"Usuario",status:"Active",photoUrl:"https://i.pravatar.cc/150?img=33"},{id:"1015",name:"Ahmed",lastName:"Hassan",username:"ahmed.hassan",email:"ahmed.hassan@example.com",password:"password123",role:"Usuario",status:"Active",photoUrl:"https://i.pravatar.cc/150?img=34"},{id:"1016",name:"Maria",lastName:"Sanchez",username:"maria.sanchez",email:"maria.sanchez@example.com",password:"password123",role:"Usuario",status:"Active",photoUrl:"https://i.pravatar.cc/150?img=35"},{id:"1017",name:"James",lastName:"Wilson",username:"james.wilson",email:"james.wilson@example.com",password:"password123",role:"Admin",status:"Active",photoUrl:"https://i.pravatar.cc/150?img=36"},{id:"1018",name:"Zoe",lastName:"Thompson",username:"zoe.thompson",email:"zoe.thompson@example.com",password:"password123",role:"Usuario",status:"Pending",photoUrl:"https://i.pravatar.cc/150?img=37"},{id:"1019",name:"Daniel",lastName:"Lee",username:"daniel.lee",email:"daniel.lee@example.com",password:"password123",role:"Usuario",status:"Active",photoUrl:"https://i.pravatar.cc/150?img=38"},{id:"1020",name:"Sophia",lastName:"Chen",username:"sophia.chen",email:"sophia.chen@example.com",password:"password123",role:"Usuario",status:"Active",photoUrl:"https://i.pravatar.cc/150?img=39"},{id:"1021",name:"Isaac",lastName:"Patel",username:"isaac.patel",email:"isaac.patel@example.com",password:"password123",role:"Usuario",status:"Pending",photoUrl:"https://i.pravatar.cc/150?img=40"},{id:"1022",name:"Grace",lastName:"Kim",username:"grace.kim",email:"grace.kim@example.com",password:"password123",role:"Usuario",status:"Active",photoUrl:"https://i.pravatar.cc/150?img=41"},{id:"1023",name:"Miguel",lastName:"Gonzalez",username:"miguel.gonzalez",email:"miguel.gonzalez@example.com",password:"password123",role:"Usuario",status:"Pending",photoUrl:"https://i.pravatar.cc/150?img=42"},{id:"1024",name:"Emma",lastName:"Watson",username:"emma.watson",email:"emma.watson@example.com",password:"password123",role:"Usuario",status:"Active",photoUrl:"https://i.pravatar.cc/150?img=43"},{id:"1025",name:"Victor",lastName:"Nguyen",username:"victor.nguyen",email:"victor.nguyen@example.com",password:"password123",role:"Usuario",status:"Active",photoUrl:"https://i.pravatar.cc/150?img=44"},{id:"1026",name:"Sofia",lastName:"Perez",username:"sofia.perez",email:"sofia.perez@example.com",password:"password123",role:"Usuario",status:"Active",photoUrl:"https://i.pravatar.cc/150?img=45"},{id:"1027",name:"Benjamin",lastName:"Scott",username:"benjamin.scott",email:"benjamin.scott@example.com",password:"password123",role:"Usuario",status:"Active",photoUrl:"https://i.pravatar.cc/150?img=46"},{id:"1028",name:"Isabella",lastName:"Torres",username:"isabella.torres",email:"isabella.torres@example.com",password:"password123",role:"Usuario",status:"Pending",photoUrl:"https://i.pravatar.cc/150?img=47"},{id:"1029",name:"William",lastName:"Sharma",username:"william.sharma",email:"william.sharma@example.com",password:"password123",role:"Usuario",status:"Active",photoUrl:"https://i.pravatar.cc/150?img=48"},{id:"1030",name:"Amelia",lastName:"Jackson",username:"amelia.jackson",email:"amelia.jackson@example.com",password:"password123",role:"Usuario",status:"Active",photoUrl:"https://i.pravatar.cc/150?img=49"},{id:"1031",name:"Lucas",lastName:"Morales",username:"lucas.morales",email:"lucas.morales@example.com",password:"password123",role:"Admin",status:"Active",photoUrl:"https://i.pravatar.cc/150?img=50"},{id:"1032",name:"Ava",lastName:"Campbell",username:"ava.campbell",email:"ava.campbell@example.com",password:"password123",role:"Usuario",status:"Pending",photoUrl:"https://i.pravatar.cc/150?img=51"},{id:"1033",name:"Noah",lastName:"Edwards",username:"noah.edwards",email:"noah.edwards@example.com",password:"password123",role:"Usuario",status:"Active",photoUrl:"https://i.pravatar.cc/150?img=52"},{id:"1034",name:"Charlotte",lastName:"Greene",username:"charlotte.greene",email:"charlotte.greene@example.com",password:"password123",role:"Usuario",status:"Active",photoUrl:"https://i.pravatar.cc/150?img=53"},{id:"1035",name:"Liam",lastName:"Connor",username:"liam.oconnor",email:"liam.oconnor@example.com",password:"password123",role:"Usuario",status:"Active",photoUrl:"https://i.pravatar.cc/150?img=54"}];constructor(){}getUsers(){return u([...this.mockUsers]).pipe(f(800))}getUserById(e){let a=this.mockUsers.find(t=>t.id===e);return a?u(w({},a)).pipe(f(500)):u({}).pipe(f(500))}createUser(e){let a=J(w({},e),{id:this.generateId()});return this.mockUsers.push(a),u(w({},a)).pipe(f(800))}updateUser(e){let a=this.mockUsers.findIndex(t=>t.id===e.id);return a!==-1?(this.mockUsers[a]=w({},e),u(w({},e)).pipe(f(800))):u({}).pipe(f(500))}deleteUser(e){let a=this.mockUsers.findIndex(t=>t.id===e);return a!==-1?(this.mockUsers.splice(a,1),u(!0).pipe(f(800))):u(!1).pipe(f(500))}generateId(){let e=this.mockUsers.map(t=>parseInt(t.id,10));return(Math.max(...e)+1).toString()}static \u0275fac=function(a){return new(a||r)};static \u0275prov=A({token:r,factory:r.\u0275fac,providedIn:"root"})};var B=class r{constructor(e,a){this.http=e;this.mockService=a;this.baseUrl=G.apiUrl,this.useMockData=G.useMockData,console.log(`UsersService initialized with ${this.useMockData?"MOCK":"REAL"} data source`)}baseUrl;useMockData;getUsers(){if(this.useMockData)return this.mockService.getUsers();let e=localStorage.getItem("token");if(!e)return console.error("No authentication token found"),_(()=>new Error("Authentication token not found. Please login again."));let a=new x().set("Authorization",`Bearer ${e}`);return console.log("Making API request to:",`${this.baseUrl}/users`),console.log("With headers:",a),this.http.get(`${this.baseUrl}/users`,{headers:a}).pipe(U(t=>console.log("Raw users from API:",t)),V(t=>t.map(n=>({id:n.id.toString(),name:n.name,lastName:n.lastName,email:n.email,role:this.mapRole(n.username),status:n.status?"Active":"Pending",photoUrl:n.photoUrl||"assets/images/user.png",originalRole:n.username}))),U(t=>console.log("Mapped Users:",t)),b(t=>(console.error("getUsers failed:",t),t.status===401?(localStorage.removeItem("token"),localStorage.removeItem("currentUser"),_(()=>new Error("Authentication expired. Please login again."))):this.handleError("getUsers",[])(t))))}getUserById(e){return this.useMockData?this.mockService.getUserById(e):this.http.get(`${this.baseUrl}/users/${e}`).pipe(U(a=>console.log(`User fetched with id=${e}`)),b(this.handleError("getUserById")))}createUser(e){return this.useMockData?this.mockService.createUser(e):this.http.post(`${this.baseUrl}/users`,e).pipe(U(a=>console.log("User created:",a)),b(this.handleError("createUser")))}createUserRequest(e){let a=localStorage.getItem("token");if(!a)return console.error("No authentication token found"),_(()=>new Error("Authentication token is missing."));let t=new x().set("Authorization",`Bearer ${a}`);return this.http.post(`${this.baseUrl}/users`,e,{headers:t}).pipe(U(n=>console.log("User created:",n)),b(this.handleError("createUserRequest")))}updateUser(e){if(this.useMockData)return this.mockService.updateUser(e);let a=localStorage.getItem("token");if(!a)return console.error("No authentication token found"),_(()=>new Error("Authentication token is missing."));let t=new x().set("Authorization",`Bearer ${a}`);return this.http.put(`${this.baseUrl}/users/${e.id}`,e,{headers:t}).pipe(U(()=>console.log(`User updated with id = ${e.id}`)),b(this.handleError("updateUser")))}updateUserRequest(e,a){let t=localStorage.getItem("token");if(!t)return _(()=>new Error("Authentication token is missing."));let n=new x().set("Authorization",`Bearer ${t}`);return this.http.put(`${this.baseUrl}/users/${e}`,a,{headers:n}).pipe(U(()=>console.log(`User updated successfully from updateUserRequest with id = ${e}`)),b(this.handleError("updateUserRequest")))}deleteUser(e){if(this.useMockData)return this.mockService.deleteUser(e);let a=localStorage.getItem("token");if(!a)return _(()=>new Error("Authentication token is missing."));let t=new x().set("Authorization",`Bearer ${a}`);return this.http.delete(`${this.baseUrl}/users/${e}`,{headers:t}).pipe(U(()=>console.log(`User deleted with id=${e}`)),b(this.handleError("deleteUser")))}setUseMockData(e){this.useMockData=e,console.log(`Switched to ${e?"MOCK":"REAL"} data source`)}handleError(e="operation",a){return t=>(console.error(`${e} failed: ${t.message}`),u(a))}mapRole(e){switch(e?.toLowerCase()){case"admin":return"Admin";case"usuario":return"Usuario";default:return"Usuario"}}static \u0275fac=function(a){return new(a||r)($(Z),$(z))};static \u0275prov=A({token:r,factory:r.\u0275fac,providedIn:"root"})};function Ve(r,e){r&1&&(i(0,"div",7),d(1,"mat-spinner",8),o())}var Ae=class r{constructor(e,a,t){this.usersService=e;this.dialog=a;this.snackBar=t}displayedColumns=["nameId","email","role","status","actions"];users=[];isLoading=!1;ngOnInit(){this.loadUsers()}loadUsers(){this.isLoading=!0,this.usersService.getUsers().subscribe({next:e=>{this.users=e,this.isLoading=!1},error:e=>{console.error("Error fetching users:",e),this.snackBar.open("Failed to load users. Please try again later.","Close",{duration:5e3}),this.isLoading=!1}})}handleEditUser(e){console.log("Edit user:",e),this.dialog.open(De,{width:"500px",data:{user:e}}).afterClosed().subscribe(t=>{t&&this.updateUser(t)})}handleDeleteUser(e){this.dialog.open(T,{width:"400px",data:{user:e}}).afterClosed().subscribe(t=>{t&&this.usersService.deleteUser(e.id).subscribe({next:()=>{this.snackBar.open("User deleted successfully","Close",{duration:3e3}),this.loadUsers()},error:n=>{console.error("Error deleting user:",n);let c="Failed to update user.";n.status===403?c="Permission denied. Only admins can update users.":n.status===404&&(c="User not found."),this.snackBar.open("Failed to delete user. Please try again later.","Close",{duration:5e3})}})})}handleFilterChange(e){console.log("Filter applied:",e)}openAddUserDialog(){this.dialog.open(q,{width:"500px",data:{user:{}}}).afterClosed().subscribe(a=>{a&&this.addUser(a)})}updateUser(e){let a={username:e.email.split("@")[0],password:e.password,email:e.email,name:e.name,lastName:e.lastName,status:e.status==="Active"};console.log("Update payload:",a),this.usersService.updateUserRequest(e.id,a).subscribe({next:()=>{this.snackBar.open("User updated successfully","Close",{duration:3e3}),this.loadUsers()},error:t=>{console.error("Error updating user:",t);let n="Failed to update user.";t.status===403?n="Permission denied. Only admins can update users.":t.status===404&&(n="User not found."),this.snackBar.open("Failed to update user. Please try again later.","Close",{duration:5e3})}})}addUser(e){let a={username:e.email.split("@")[0],password:e.password,email:e.email,name:e.name,lastName:e.lastName,status:e.status==="Active"};this.usersService.createUserRequest(a).subscribe({next:t=>{this.snackBar.open("User added successfully","Close",{duration:3e3}),this.loadUsers()},error:t=>{console.error("Error adding user:",t);let n="Failed to update user.";t.status===403?n="Permission denied. Only admins can update users.":t.status===404&&(n="User not found."),this.snackBar.open(n,"Close",{duration:5e3})}})}static \u0275fac=function(a){return new(a||r)(g(B),g(_e),g(we))};static \u0275cmp=C({type:r,selectors:[["app-user-management"]],decls:12,vars:3,consts:[[1,"user-management-container"],[1,"user-management-header"],[1,"actions"],["mat-raised-button","",1,"btn-adduser",3,"click"],[1,"bi","bi-plus",2,"margin-right","8px"],["class","loading-spinner",4,"ngIf"],[3,"editUser","deleteUser","filterChange","userData","displayedColumns"],[1,"loading-spinner"],["diameter","40"]],template:function(a,t){a&1&&(d(0,"app-header-nav")(1,"app-sidebar"),i(2,"main",0)(3,"div",1)(4,"h1"),s(5,"User Management"),o(),i(6,"div",2)(7,"button",3),v("click",function(){return t.openAddUserDialog()}),d(8,"i",4),s(9," Add new user "),o()()(),p(10,Ve,2,0,"div",5),i(11,"app-users-table",6),v("editUser",function(c){return t.handleEditUser(c)})("deleteUser",function(c){return t.handleDeleteUser(c)})("filterChange",function(c){return t.handleFilterChange(c)}),o()()),a&2&&(l(10),m("ngIf",t.isLoading),l(),m("userData",t.users)("displayedColumns",t.displayedColumns))},dependencies:[M,E,ge,he,be,fe,y,D,k,Ce,xe,Me],styles:["html[_ngcontent-%COMP%], body[_ngcontent-%COMP%]{font-family:Murecho,sans-serif;height:100vh;margin:0;padding:0;overflow:hidden}body[_ngcontent-%COMP%]{background-color:#f6f6f6}.user-management-container[_ngcontent-%COMP%]{height:calc(100vh - 100px);padding:20px 50px;margin-left:320px;background-color:#f6f6f6}.user-management-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.user-management-header[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:center}h1[_ngcontent-%COMP%]{margin:0;font-family:Murecho,sans-serif!important}.user-table-wrapper[_ngcontent-%COMP%]{overflow-x:auto}.user-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.user-info[_ngcontent-%COMP%]   .user-photo[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;object-fit:cover}.user-info[_ngcontent-%COMP%]   .user-name[_ngcontent-%COMP%]{font-weight:700}.user-info[_ngcontent-%COMP%]   .user-id[_ngcontent-%COMP%]{font-size:12px;color:gray}.btn-adduser[_ngcontent-%COMP%]{color:#000!important;background-color:#70d3c3!important;border-radius:10px;border:black 1px solid;display:flex;align-items:center;padding:0 14px;line-height:1}.loading-spinner[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:100vh}"]})};export{Ae as UserManagementComponent};
