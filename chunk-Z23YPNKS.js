import{b as re}from"./chunk-C26AM5V3.js";import{a as b,b as A,c as ae,d as v,e as R,f as D,g as _}from"./chunk-YEFIVP7E.js";import{e as de,f as me,g as ce,h as U}from"./chunk-ADTCRSQC.js";import{a as se,b as le,c as F,d as L}from"./chunk-MXKXLBHX.js";import{a as te}from"./chunk-K56RLFWU.js";import{b as oe}from"./chunk-BWVLDLIA.js";import"./chunk-JJGEEKG2.js";import"./chunk-LCBHQNYP.js";import"./chunk-UGN5LNS4.js";import{a as ne,b as T}from"./chunk-BOFTZJPA.js";import{M as h,N as C,b as ee,g as ie,h as w}from"./chunk-Z7IPVWHD.js";import{b as Y,f as E,i as O,m as Z,o as I}from"./chunk-3NOR6IXB.js";import"./chunk-AZTHPTC5.js";import{Fb as t,Gb as n,Hb as f,Hc as X,Ic as S,Kc as u,Lb as K,Nb as p,Ob as Q,Ya as J,Yb as s,Zb as k,_a as l,_b as V,ac as P,bc as y,cc as x,db as m,ka as $,kb as g,la as H,pb as M,wb as c}from"./chunk-RHI7NKML.js";var N=class a{constructor(i){this.dialogRef=i}roleName="";onCancel(){this.dialogRef.close()}onSave(){this.roleName.trim()?this.dialogRef.close(this.roleName):alert("Role name cannot be empty")}static \u0275fac=function(e){return new(e||a)(m(b))};static \u0275cmp=g({type:a,selectors:[["app-add-role-dialog"]],decls:12,vars:2,consts:[["mat-dialog-title",""],["appearance","outline",2,"width","100%"],["matInput","","placeholder","Enter role name","required","",3,"ngModelChange","ngModel"],["align","end"],["mat-button","",3,"click"],["mat-raised-button","","color","primary",3,"click","disabled"]],template:function(e,o){e&1&&(t(0,"h2",0),s(1,"New Role Addition"),n(),t(2,"mat-dialog-content")(3,"mat-form-field",1)(4,"mat-label"),s(5,"Role"),n(),t(6,"input",2),x("ngModelChange",function(d){return y(o.roleName,d)||(o.roleName=d),d}),n()()(),t(7,"mat-dialog-actions",3)(8,"button",4),p("click",function(){return o.onCancel()}),s(9,"Cancel"),n(),t(10,"button",5),p("click",function(){return o.onSave()}),s(11," Save Role "),n()()),e&2&&(l(6),P("ngModel",o.roleName),l(4),c("disabled",!o.roleName.trim()))},dependencies:[u,_,v,D,R,C,h,w,ie,ee,T,ne,I,Y,E,Z,O],encapsulation:2})};var B=class a{constructor(i,e){this.dialogRef=i;this.role=e}onCancel(){this.dialogRef.close(!1)}onDelete(){this.dialogRef.close(!0)}static \u0275fac=function(e){return new(e||a)(m(b),m(A))};static \u0275cmp=g({type:a,selectors:[["app-delete-confirmation-dialog"]],decls:14,vars:2,consts:[["mat-dialog-title",""],[1,"role-info"],["alt","Role","width","40","height","40",2,"border-radius","50%",3,"src"],["align","end"],["mat-button","",3,"click"],["mat-raised-button","","color","warn",3,"click"]],template:function(e,o){e&1&&(t(0,"h2",0),s(1,"Confirm role deletion"),n(),t(2,"mat-dialog-content")(3,"p"),s(4,"Are you sure you want to delete this role?"),n(),t(5,"div",1),f(6,"img",2),t(7,"span"),s(8),n()()(),t(9,"mat-dialog-actions",3)(10,"button",4),p("click",function(){return o.onCancel()}),s(11,"Cancel"),n(),t(12,"button",5),p("click",function(){return o.onDelete()}),s(13,"Delete"),n()()),e&2&&(l(6),c("src",o.role.photoUrl,J),l(2),k(o.role.name))},dependencies:[u,_,v,D,R,C,h],styles:[".role-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;margin-top:16px;padding:12px;border:1px solid #e0e0e0;border-radius:8px;background-color:#f9f9f9}.role-info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:500}"]})};function _e(a,i){a&1&&(t(0,"div",7),f(1,"mat-spinner",8),t(2,"p"),s(3,"Loading permissions..."),n()())}function Me(a,i){if(a&1){let e=K();t(0,"mat-checkbox",15),x("ngModelChange",function(r){let d=$(e).$implicit;return y(d.checked,r)||(d.checked=r),H(r)}),s(1),n()}if(a&2){let e=i.$implicit;P("ngModel",e.checked),l(),V(" ",e.name," ")}}function be(a,i){if(a&1&&(t(0,"div",12)(1,"h3"),s(2),n(),t(3,"div",13),M(4,Me,2,2,"mat-checkbox",14),n()()),a&2){let e=i.$implicit;l(2),k(e.name),l(2),c("ngForOf",e.permissions)}}function ve(a,i){if(a&1&&(t(0,"div",9)(1,"div",10),M(2,be,5,2,"div",11),n()()),a&2){let e=Q();l(2),c("ngForOf",e.permissionGroups)}}var j=class a{constructor(i,e,o){this.dialogRef=i;this.data=e;this.rolesService=o}roleId;role;isLoading=!0;permissionGroups=[{name:"User Management",permissions:[{id:"view_users",name:"View Users",checked:!1},{id:"create_users",name:"Create Users",checked:!1},{id:"edit_users",name:"Edit Users",checked:!1},{id:"delete_users",name:"Delete Users",checked:!1}]},{name:"Course Management",permissions:[{id:"view_courses",name:"View Courses",checked:!1},{id:"create_courses",name:"Create Courses",checked:!1},{id:"edit_courses",name:"Edit Courses",checked:!1},{id:"delete_courses",name:"Delete Courses",checked:!1}]},{name:"Report Management",permissions:[{id:"view_reports",name:"View Reports",checked:!1},{id:"create_reports",name:"Create Reports",checked:!1},{id:"export_reports",name:"Export Reports",checked:!1}]}];ngOnInit(){this.roleId=this.data.roleId,this.loadRoleData()}loadRoleData(){this.isLoading=!0,this.rolesService.getRoleById(this.roleId).subscribe({next:i=>{if(this.role=i,!this.role||!this.role.id){this.dialogRef.close();return}this.rolesService.getRolePermissions(this.roleId).subscribe({next:e=>{this.resetPermissions(),this.setPermissionsFromArray(e),this.isLoading=!1},error:e=>{console.error("Error loading permissions:",e),this.isLoading=!1,this.dialogRef.close()}})},error:i=>{console.error("Error loading role:",i),this.isLoading=!1,this.dialogRef.close()}})}resetPermissions(){this.permissionGroups.forEach(i=>{i.permissions.forEach(e=>{e.checked=!1})})}setPermissionsFromArray(i){!i||!Array.isArray(i)||i.forEach(e=>{this.setPermission(e,!0)})}setPermission(i,e){for(let o of this.permissionGroups){let r=o.permissions.find(d=>d.id===i);if(r){r.checked=e;break}}}savePermissions(){if(!this.role)return;this.isLoading=!0;let i=[];this.permissionGroups.forEach(e=>{e.permissions.forEach(o=>{o.checked&&i.push(o.id)})}),this.rolesService.updateRolePermissions(this.roleId,i).subscribe({next:()=>{this.isLoading=!1,this.dialogRef.close(!0)},error:e=>{console.error("Error saving permissions:",e),this.isLoading=!1,this.dialogRef.close(!1)}})}cancel(){this.dialogRef.close(!1)}static \u0275fac=function(e){return new(e||a)(m(b),m(A),m(U))};static \u0275cmp=g({type:a,selectors:[["app-edit-roles-permission-dialog"]],decls:10,vars:4,consts:[[1,"dialog-container"],["mat-dialog-title",""],["class","loading-container",4,"ngIf"],["mat-dialog-content","",4,"ngIf"],["mat-dialog-actions","","align","end"],["mat-button","",3,"click"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"loading-container"],["diameter","40"],["mat-dialog-content",""],[1,"permissions-container"],["class","permission-group",4,"ngFor","ngForOf"],[1,"permission-group"],[1,"permission-list"],["color","primary","class","permission-checkbox",3,"ngModel","ngModelChange",4,"ngFor","ngForOf"],["color","primary",1,"permission-checkbox",3,"ngModelChange","ngModel"]],template:function(e,o){e&1&&(t(0,"div",0)(1,"h2",1),s(2),n(),M(3,_e,4,0,"div",2)(4,ve,3,1,"div",3),t(5,"div",4)(6,"button",5),p("click",function(){return o.cancel()}),s(7,"Cancel"),n(),t(8,"button",6),p("click",function(){return o.savePermissions()}),s(9," Save Permissions "),n()()()),e&2&&(l(2),V("Edit Permissions for ",o.role==null?null:o.role.name,""),l(),c("ngIf",o.isLoading),l(),c("ngIf",!o.isLoading),l(4),c("disabled",o.isLoading))},dependencies:[u,X,S,de,C,h,ce,me,w,T,I,E,O,_,v,D,R,L,F],styles:[".edit-role-container[_ngcontent-%COMP%]{padding:20px;max-width:800px}.edit-role-container[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin-bottom:20px;color:#333}.edit-role-container[_ngcontent-%COMP%]   .role-header[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:20px}.edit-role-container[_ngcontent-%COMP%]   .role-header[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:50%;margin-right:15px;object-fit:cover}.edit-role-container[_ngcontent-%COMP%]   .role-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.5rem;font-weight:500}.edit-role-container[_ngcontent-%COMP%]   .permissions-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px;margin-bottom:24px}.edit-role-container[_ngcontent-%COMP%]   .permissions-container[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]{margin-bottom:0}.edit-role-container[_ngcontent-%COMP%]   .permissions-container[_ngcontent-%COMP%]   .permissions-list[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:10px;padding:10px 0}.edit-role-container[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:10px;margin-top:20px}p[_ngcontent-%COMP%]{font-family:Murecho,sans-serif}.loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:100%}"]})};function Re(a,i){a&1&&(t(0,"div",6),f(1,"mat-spinner",7),n())}var pe=class a{constructor(i,e,o){this.dialog=i;this.snackBar=e;this.rolesService=o}roles=[];displayedColumns=["nameId","actions"];adaptedRolesData=[];isLoading=!0;ngOnInit(){this.loadRoles()}loadRoles(){this.isLoading=!0,this.rolesService.getRoles().subscribe({next:i=>{this.roles=i,this.adaptRolesToUserData(),this.isLoading=!1},error:i=>{console.error("Error loading roles:",i),this.isLoading=!1,this.snackBar.open("Failed to load roles. Please try again later.","Close",{duration:5e3,panelClass:["error-snackbar"]})}})}adaptRolesToUserData(){this.adaptedRolesData=this.roles.map(i=>({id:i.id.toString(),fullName:i.name,email:"",role:i.name,status:"Active",photoUrl:i.photoUrl,originalRole:i}))}openAddRoleDialog(){this.dialog.open(N,{width:"400px"}).afterClosed().subscribe(e=>{if(e){this.isLoading=!0;let o={id:0,name:e,photoUrl:"assets/images/default-role-icon.svg"};this.rolesService.createRole(o).subscribe({next:r=>{this.loadRoles(),this.snackBar.open(`Role '${r.name}' created successfully`,"Close",{duration:3e3,panelClass:["success-snackbar"]})},error:r=>{console.error("Error creating role:",r),this.isLoading=!1,this.snackBar.open("Failed to create role. Please try again later.","Close",{duration:5e3,panelClass:["error-snackbar"]})}})}})}findOriginalRole(i){return this.roles.find(e=>e.id.toString()===i.id)}editPermissions(i){let e=this.findOriginalRole(i);e&&this.dialog.open(j,{width:"800px",data:{roleId:e.id}}).afterClosed().subscribe(r=>{r&&(this.isLoading=!0,setTimeout(()=>{this.loadRoles(),this.snackBar.open(`Permissions for '${e.name}' updated successfully`,"Close",{duration:3e3,panelClass:["success-snackbar"]})},500))})}deleteRole(i){let e=this.findOriginalRole(i);e&&this.dialog.open(B,{width:"400px",data:e}).afterClosed().subscribe(r=>{if(r){this.isLoading=!0;let d=e.name;this.rolesService.deleteRole(e.id).subscribe({next:()=>{this.loadRoles(),this.snackBar.open(`Role '${d}' deleted successfully`,"Close",{duration:3e3,panelClass:["warning-snackbar"]})},error:ge=>{console.error("Error deleting role:",ge),this.isLoading=!1,this.snackBar.open("Failed to delete role. Please try again later.","Close",{duration:5e3,panelClass:["error-snackbar"]})}})}})}applyFilter(i){console.log("Filter applied:",i)}static \u0275fac=function(e){return new(e||a)(m(ae),m(se),m(U))};static \u0275cmp=g({type:a,selectors:[["app-roles-management"]],decls:11,vars:3,consts:[[1,"roles-management-container"],[1,"header"],["mat-raised-button","","color","primary",1,"btn-addrole",3,"click"],[1,"bi","bi-plus",2,"margin-right","8px"],["class","loading-spinner",4,"ngIf"],[3,"editUser","deleteUser","filterChange","displayedColumns","userData"],[1,"loading-spinner"],["diameter","40"]],template:function(e,o){e&1&&(f(0,"app-header-nav")(1,"app-sidebar"),t(2,"div",0)(3,"div",1)(4,"h1"),s(5,"User Roles"),n(),t(6,"button",2),p("click",function(){return o.openAddRoleDialog()}),f(7,"i",3),s(8," Add new role "),n()(),M(9,Re,2,0,"div",4),t(10,"app-users-table",5),p("editUser",function(d){return o.editPermissions(d)})("deleteUser",function(d){return o.deleteRole(d)})("filterChange",function(d){return o.applyFilter(d)}),n()()),e&2&&(l(9),c("ngIf",o.isLoading),l(),c("displayedColumns",o.displayedColumns)("userData",o.adaptedRolesData))},dependencies:[u,S,oe,te,re,C,h,_,L,F,le],styles:["html[_ngcontent-%COMP%], body[_ngcontent-%COMP%]{font-family:Murecho,sans-serif;height:100vh;margin:0;padding:0;overflow:hidden}.roles-management-container[_ngcontent-%COMP%]{height:calc(100vh - 100px);padding:20px 50px;margin-left:320px;background-color:#f6f6f6}.roles-management-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}h1[_ngcontent-%COMP%]{margin:0;font-family:Murecho,sans-serif!important}.btn-addrole[_ngcontent-%COMP%]{color:#000!important;background-color:#70d3c3!important;border-radius:10px;border:black 1px solid;display:flex;align-items:center;padding:0 14px;line-height:1}.loading-spinner[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:100vh}  .success-snackbar{background-color:#4caf50!important;color:#fff}  .warning-snackbar{background-color:#ff9800!important;color:#fff}  .error-snackbar{background-color:#f44336!important;color:#fff}  .mat-mdc-snack-bar-action{color:#fff!important}"]})};export{pe as RolesComponent};
