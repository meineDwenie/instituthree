import{a as H,b as z,c as J,d as $,e as q,f as K,g as Q,h as X}from"./chunk-HNDYEKJP.js";import{a as j,b as G,d as W}from"./chunk-MXKXLBHX.js";import{a as U}from"./chunk-YNFTKU7D.js";import{b as D}from"./chunk-UYOCD7B4.js";import"./chunk-FXHPCVZO.js";import"./chunk-LCBHQNYP.js";import{k as I,m as w}from"./chunk-DI2GF6D7.js";import{b as V}from"./chunk-BOFTZJPA.js";import{M as T,N as A,h as L}from"./chunk-Z7IPVWHD.js";import{f as F,i as B,o as N}from"./chunk-3NOR6IXB.js";import"./chunk-AZTHPTC5.js";import{Fb as r,Gb as s,Hb as g,Hc as E,Ic as y,Kc as S,Lb as k,Nb as u,Ob as x,Ya as M,Yb as l,Zb as f,_a as a,_b as P,ac as b,bc as R,cc as O,db as c,ka as _,kb as v,la as C,pb as p,wb as m,x as h}from"./chunk-RHI7NKML.js";function Z(i,t){if(i&1&&(r(0,"div",7),g(1,"img",8),r(2,"h2"),l(3),s()()),i&2){let e=x();a(),m("src",e.role.photoUrl,M),a(2),f(e.role.name)}}function ee(i,t){if(i&1){let e=k();r(0,"mat-checkbox",11),O("ngModelChange",function(n){let d=_(e).$implicit;return R(d.checked,n)||(d.checked=n),C(n)}),l(1),s()}if(i&2){let e=t.$implicit;b("ngModel",e.checked),a(),P(" ",e.name," ")}}function te(i,t){if(i&1&&(r(0,"mat-card")(1,"mat-card-header")(2,"mat-card-title"),l(3),s()(),r(4,"mat-card-content")(5,"div",9),p(6,ee,2,2,"mat-checkbox",10),s()()()),i&2){let e=t.$implicit;a(3),f(e.name),a(3),m("ngForOf",e.permissions)}}var Y=class i{constructor(t,e,o,n){this.route=t;this.router=e;this.rolesService=o;this.snackBar=n}roleId;role;isLoading=!0;permissionGroups=[{name:"User Management",permissions:[{id:"view_users",name:"View Users",checked:!1},{id:"create_users",name:"Create Users",checked:!1},{id:"edit_users",name:"Edit Users",checked:!1},{id:"delete_users",name:"Delete Users",checked:!1}]},{name:"Course Management",permissions:[{id:"view_courses",name:"View Courses",checked:!1},{id:"create_courses",name:"Create Courses",checked:!1},{id:"edit_courses",name:"Edit Courses",checked:!1},{id:"delete_courses",name:"Delete Courses",checked:!1}]},{name:"Report Management",permissions:[{id:"view_reports",name:"View Reports",checked:!1},{id:"create_reports",name:"Create Reports",checked:!1},{id:"export_reports",name:"Export Reports",checked:!1}]}];ngOnInit(){if(this.roleId=Number(this.route.snapshot.paramMap.get("id")),isNaN(this.roleId)||this.roleId<=0){this.router.navigate(["/roles-management"]);return}this.loadRoleData()}loadRoleData(){this.isLoading=!0,h({role:this.rolesService.getRoleById(this.roleId),permissions:this.rolesService.getRolePermissions(this.roleId)}).subscribe({next:t=>{if(this.role=t.role,!this.role||!this.role.id){this.snackBar.open("Role not found","Close",{duration:3e3,panelClass:["error-snackbar"]}),this.router.navigate(["/roles-management"]);return}this.resetPermissions(),this.setPermissionsFromArray(t.permissions),this.isLoading=!1},error:t=>{console.error("Error loading role data:",t),this.isLoading=!1,this.snackBar.open("Failed to load role data. Please try again later.","Close",{duration:5e3,panelClass:["error-snackbar"]}),this.router.navigate(["/roles-management"])}})}resetPermissions(){this.permissionGroups.forEach(t=>{t.permissions.forEach(e=>{e.checked=!1})})}setPermissionsFromArray(t){!t||!Array.isArray(t)||t.forEach(e=>{this.setPermission(e,!0)})}setPermission(t,e){for(let o of this.permissionGroups){let n=o.permissions.find(d=>d.id===t);if(n){n.checked=e;break}}}savePermissions(){if(!this.role)return;this.isLoading=!0;let t=[];this.permissionGroups.forEach(e=>{e.permissions.forEach(o=>{o.checked&&t.push(o.id)})}),this.rolesService.updateRolePermissions(this.roleId,t).subscribe({next:()=>{this.isLoading=!1,this.snackBar.open("Permissions saved successfully","Close",{duration:3e3,panelClass:["success-snackbar"]}),this.router.navigate(["/roles-management"])},error:e=>{console.error("Error saving permissions:",e),this.isLoading=!1,this.snackBar.open("Failed to save permissions. Please try again later.","Close",{duration:5e3,panelClass:["error-snackbar"]})}})}cancel(){this.router.navigate(["/roles-management"])}static \u0275fac=function(e){return new(e||i)(c(I),c(w),c(X),c(j))};static \u0275cmp=v({type:i,selectors:[["app-edit-roles"]],decls:13,vars:2,consts:[[1,"edit-role-container"],["class","role-header",4,"ngIf"],[1,"permissions-container"],[4,"ngFor","ngForOf"],[1,"actions"],["mat-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"],[1,"role-header"],["alt","Role",3,"src"],[1,"permissions-list"],[3,"ngModel","ngModelChange",4,"ngFor","ngForOf"],[3,"ngModelChange","ngModel"]],template:function(e,o){e&1&&(g(0,"app-header-nav")(1,"app-sidebar"),r(2,"div",0)(3,"h1"),l(4,"Edit Role Permissions"),s(),p(5,Z,4,2,"div",1),r(6,"div",2),p(7,te,7,2,"mat-card",3),s(),r(8,"div",4)(9,"button",5),u("click",function(){return o.cancel()}),l(10,"Cancel"),s(),r(11,"button",6),u("click",function(){return o.savePermissions()}),l(12," Save Permissions "),s()()()),e&2&&(a(5),m("ngIf",o.role),a(2),m("ngForOf",o.permissionGroups))},dependencies:[S,E,y,D,U,q,H,J,$,z,A,T,Q,K,L,V,N,F,B,W,G],styles:[".edit-role-container[_ngcontent-%COMP%]{padding:20px;max-width:800px;margin:0 auto}.edit-role-container[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin-bottom:20px}.edit-role-container[_ngcontent-%COMP%]   .role-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;margin-bottom:24px}.edit-role-container[_ngcontent-%COMP%]   .role-header[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:50%}.edit-role-container[_ngcontent-%COMP%]   .role-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0}.edit-role-container[_ngcontent-%COMP%]   .permissions-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px;margin-bottom:24px}.edit-role-container[_ngcontent-%COMP%]   .permissions-container[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]{padding-bottom:16px}.edit-role-container[_ngcontent-%COMP%]   .permissions-container[_ngcontent-%COMP%]   .permissions-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;padding:8px 0}.edit-role-container[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:12px;margin-top:24px}"]})};export{Y as EditRolesComponent};
